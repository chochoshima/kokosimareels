<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading Prompt... | Kokosima AI</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
</head>
<body>

<header class="top-bar">
    <a href="index.html" class="btn-back">â† BACK</a>
    <a href="index.html" class="logo">Kokosima</a>
</header>

<main class="prompt-page-wrapper">
  <div class="prompt-card">
    <div class="media-container">
      <img id="main-image" alt="Prompt Preview" hidden style="width:100%; height:100%; object-fit:cover;">
    </div>
    <div class="content-container">
      <h3 id="title">Loading...</h3>
      <p id="promptText">Memuat prompt...</p>
      <div class="actions">
        <button class="btn btn-primary" id="copyBtn">ğŸ“‹ Copy Prompt</button>
        <button class="btn-like" id="likeBtn">â¤ï¸ <span id="likeCount">0</span></button>
      </div>
        <div id="comment-section" style="margin-top: 30px; border-top: 1px solid var(--border-soft); padding-top: 20px; width: 100%;">
          <h4 style="margin-bottom: 15px; color: var(--text-dim); font-size: 14px; text-transform: uppercase; letter-spacing: 1px;">ğŸ’¬ Diskusi Anonim</h4>
          
          <div id="cusdis_thread"
            data-host="https://cusdis.com"
            data-app-id="69785bf6-5db3-4bd7-b825-141cbd5e2440"
            data-page-id="" 
            data-page-url=""
            data-page-title=""
            data-theme="dark">
          </div>
      </div>
      <div class="floating-visitor" id="visitorBar">
        ğŸ‘ï¸ <span id="visitorToday">0</span> hari ini Â· <strong id="visitorTotal">0</strong> total
      </div>
    </div>
  </div>
</main>

<script src="data.js"></script>
<script>
const WORKER_URL = "https://visitor-counter.kokopujiyanto.workers.dev";
const params = new URLSearchParams(window.location.search);
const promptId = params.get("id");

if (!promptId || !PROMPT_DATABASE[promptId]) {
    window.location.href = "index.html";
} else {
    const data = PROMPT_DATABASE[promptId];
    document.title = data.title + " | Kokosima AI";
    document.getElementById("title").textContent = data.title;
    document.getElementById("promptText").textContent = data.text;

    const img = document.getElementById("main-image");
    img.src = `images/${promptId}.webp`;
    img.onerror = () => img.src = `images/${promptId}.jpg`;
    img.onload = () => img.hidden = false;

    // Copy Logic
    document.getElementById("copyBtn").onclick = async () => {
        await navigator.clipboard.writeText(data.text);
        const btn = document.getElementById("copyBtn");
        btn.textContent = "âœ… Copied";
        setTimeout(() => btn.textContent = "ğŸ“‹ Copy Prompt", 1600);
    };

    // Like Logic (1 User 1 Like)
    const likeBtn = document.getElementById('likeBtn');
    const likeCountLabel = document.getElementById('likeCount');

    async function initLikes() {
        try {
            const res = await fetch(`${WORKER_URL}/?action=like&imageId=${promptId}`);
            const result = await res.json();
            likeCountLabel.innerText = result.likes || 0;
            if (localStorage.getItem('liked_' + promptId)) likeBtn.classList.add('active');
        } catch (e) {}
    }

    likeBtn.onclick = async () => {
        if (localStorage.getItem('liked_' + promptId)) {
            alert("Anda sudah memberikan Like! ğŸ˜Š");
            return;
        }
        likeBtn.disabled = true;
        try {
            const res = await fetch(`${WORKER_URL}/?action=like&imageId=${promptId}`, { method: 'POST' });
            const result = await res.json();
            likeCountLabel.innerText = result.likes;
            likeBtn.classList.add('active');
            localStorage.setItem('liked_' + promptId, 'true');
        } catch (e) {
            alert("Gagal koneksi server");
        } finally {
            likeBtn.disabled = false;
        }
    };
    initLikes();
}
</script>
<script src="visitor.js" defer></script>
</body>
</html>
