<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Loading Prompt... | Kokosima AI</title>

<!-- OPEN GRAPH -->
<meta property="og:type" content="article">
<meta property="og:title" id="meta-title" content="Kokosima AI">
<meta property="og:description" id="meta-desc" content="Temukan prompt AI cinematic gratis.">
<meta property="og:url" id="meta-url" content="https://kokosimareels.pages.dev/">
<meta property="og:image" id="meta-img" content="https://kokosimareels.pages.dev/images/default-preview.jpg">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">

<link rel="stylesheet" href="style.css">

<style>
.prompt-detail-img{
    width:100%;
    max-width:520px;
    margin:0 auto 18px;
    display:block;
    border-radius:14px;
    box-shadow:0 6px 18px rgba(0,0,0,.25);
}
#promptText{
    width:100%;
    min-height:220px;
    padding:16px;
    font-family:monospace;
    font-size:14px;
    border-radius:10px;
    border:1px solid rgba(255,255,255,.15);
    background:rgba(0,0,0,.35);
    color:#e5e7eb;
    resize:none;
}
.prompt-page-wrapper {
    display:flex;
    justify-content:center;
    align-items:flex-start;
    padding:100px 20px 40px;
}
.prompt-card {
    width:100%;
    max-width:600px;
    display:flex;
    flex-direction:column;
    align-items:center;
    text-align:center;
    gap:12px;
}
</style>
</head>

<body>

<header class="top-bar">
    <a href="index.html" class="btn-back">‚Üê BACK</a>
    <a href="index.html" class="logo">Kokosima</a>
</header>

<main class="prompt-page-wrapper">
<div class="prompt-card">

    <img id="main-image" class="prompt-detail-img" alt="Prompt Preview" hidden>

    <h2 id="title">Loading...</h2>
    <div id="viewCounter" class="prompt-view">
    üëÅÔ∏è <span id="viewCount">0</span> views
    </div>

    <textarea
        id="promptText"
        readonly
        spellcheck="false"
    >Memuat prompt...</textarea>

    <div style="display:flex;justify-content:center;margin-top:14px;gap:10px;">
        <button class="btn btn-primary" id="copyBtn">üìã Copy Prompt</button>
        <a class="btn btn-outline" id="shareBtn" href="#">üîó Share</a>
    </div>

</div>
</main>

<script src="data.js"></script>

<script>
/* =========================
   LOAD DATA
========================= */
const params = new URLSearchParams(window.location.search);
const id = params.get("id");

if (!id || typeof PROMPT_DATABASE === "undefined" || !PROMPT_DATABASE[id]) {
    window.location.href = "index.html";
}

const data = PROMPT_DATABASE[id];
const domain = "https://kokosimareels.pages.dev";

// Coba pakai .webp dulu, jika gagal fallback ke .jpg
const img = document.getElementById("main-image");
img.src = `${domain}/images/${id}.webp`;
img.onerror = () => { img.onerror = null; img.src = `${domain}/images/${id}.jpg`; };
img.hidden = false;

// TITLE & CONTENT
document.title = `${data.title} | Kokosima AI`;
document.getElementById("title").textContent = data.title;
document.getElementById("promptText").value = data.text;

// META SHARE
document.getElementById("meta-title").content = data.title;
document.getElementById("meta-desc").content = data.text.slice(0,150);
document.getElementById("meta-url").content = window.location.href;
document.getElementById("meta-img").content = img.src;

/* =========================
   COPY PROMPT
========================= */
document.getElementById("copyBtn").onclick = async () => {
    try {
        await navigator.clipboard.writeText(data.text);
        const btn = document.getElementById("copyBtn");
        btn.textContent = "‚úÖ Copied";
        setTimeout(() => btn.textContent = "üìã Copy Prompt", 1600);
    } catch {
        alert("Gagal menyalin prompt");
    }
};

/* =========================
   SHARE
========================= */
document.getElementById("shareBtn").onclick = () => {
    const url = window.location.href;
    if (navigator.share) {
        navigator.share({ title: data.title, url });
    } else {
        window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`);
    }
};

/* =========================
   VISITOR PER PROMPT
========================= */
const VISITOR_ENDPOINT = "https://kokosima-visitor.kokopujiyanto.workers.dev";

fetch(`${VISITOR_ENDPOINT}?page=prompt:${id}`, {
    headers: { "Accept": "application/json" }
})
.then(r => r.json())
.then(d => console.log("Visitor:", d))
.catch(e => console.warn("Visitor error:", e));
</script>

</body>
</html>
