<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kokosima AI - Katalog Prompt Cinematic</title>
    
    <meta name="description" content="Koleksi prompt AI Cinematic gratis untuk Midjourney, Dall-E, dan Stable Diffusion.">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://kokosima-ai.pages.dev/">
    <meta property="og:title" content="Kokosima AI - Katalog Prompt Cinematic">
    <meta property="og:description" content="Koleksi prompt AI Cinematic gratis untuk Midjourney, Dall-E, dan Stable Diffusion.">
    <meta property="og:image" content="https://kokosima-ai.pages.dev/images/default-preview.jpg">

    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://kokosima-ai.pages.dev/">
    <meta property="twitter:title" content="Kokosima AI - Katalog Prompt Cinematic">
    <meta property="twitter:description" content="Koleksi prompt AI Cinematic gratis untuk Midjourney, Dall-E, dan Stable Diffusion.">
    <meta property="twitter:image" content="https://kokosima-ai.pages.dev/images/default-preview.jpg">

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="images/icon-192.png">

    <link rel="stylesheet" href="style.css">
</head>
<body>

<header class="top-bar">
    <a href="index.html" class="logo-link">
        <span class="logo">üß† kokosima</span>
    </a>

    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Cari (hutan, robot, neon...)" autocomplete="off">
    </div>

    <div class="social-links">
        <a href="https://www.facebook.com/chochoshima/" target="_blank">Facebook</a>
        <a href="https://www.youtube.com/@kokosimaabsurd/" target="_blank">YouTube</a>
    </div>
</header>

<main class="feed" id="main-feed"></main>

<script src="data.js"></script>

<script>
/* ==========================
   VIEWPORT MOBILE HEIGHT
========================== */
function setVh(){
    const vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
}
window.addEventListener('resize', setVh);
window.addEventListener('load', setVh);
setVh();

/* ==========================
   FEED GENERATOR (OPTIMIZED)
========================== */
const CHANNEL_YOUTUBE = "https://youtube.com/@kokosimaabsurd";
const feedContainer = document.getElementById("main-feed");

function generateFeed(keysToRender = null) {
    if (typeof PROMPT_DATABASE === 'undefined') {
        feedContainer.innerHTML = `<div style="text-align:center; padding: 2rem; color: #cc0000;"><h3>Gagal Memuat Data</h3></div>`;
        return;
    }

    // Bersihkan kontainer sebelum render ulang
    feedContainer.innerHTML = "";

    const fragment = document.createDocumentFragment();
    
    // Tentukan ID mana yang akan ditampilkan (filter atau semua)
    let keys = keysToRender || Object.keys(PROMPT_DATABASE);
    
    // Jika tampilan awal (bukan search), urutkan dari yang terbaru
    if (!keysToRender) {
        keys = [...keys].reverse();
    }

    if (keys.length === 0) {
        feedContainer.innerHTML = `<div class="no-results"><h3>Prompt "${document.getElementById('searchInput').value}" tidak ditemukan...</h3></div>`;
        return;
    }

    keys.forEach(id => {
        try {
            const data = PROMPT_DATABASE[id];
            if (!data || !data.title) return;

            const safeText = data.text || ""; 
            const words = safeText.split(/\s+/);
            const previewText = words.length > 0 
                ? words.slice(0, 10).join(" ") + (words.length > 10 ? "..." : "")
                : "Tidak ada deskripsi.";

            const hasVideo = data.videoUrl && data.videoUrl !== "#";
            const btnLabel = hasVideo ? "‚ñ∂ Video" : "üì∫"; 
            const btnHref = hasVideo ? data.videoUrl : CHANNEL_YOUTUBE;
            const ytClass = hasVideo ? "" : "btn-yt-small";
            const btnStyle = hasVideo ? "" : "style='background:#cc0000;color:#fff;'";

            const section = document.createElement("section");
            section.className = "item";
            section.id = id;
            section.innerHTML = `
                <div class="media-container">
                    <img src="images/${id}.webp" alt="${data.title}" loading="lazy" decoding="async"
                    onerror="this.onerror=null;this.src='images/${id}.jpg';">
                </div>
                <div class="content-container">
                    <h3 title="${data.title}">${data.title}</h3>
                    <p class="prompt-preview">${previewText}</p>
                    <div class="actions">
                        <a class="btn btn-primary ${ytClass}" href="${btnHref}" target="_blank" ${btnStyle}>${btnLabel}</a>
                        <a class="btn btn-outline" href="prompt.html?id=${id}">PROMPT</a>
                        <button class="btn btn-share" onclick="sharePrompt('${id}')">üîó</button>
                    </div>
                </div>
            `;
            fragment.appendChild(section);
        } catch (err) { console.error(err); }
    });

    feedContainer.appendChild(fragment);
}

// Inisialisasi awal
generateFeed();

/* ==========================
   SEARCH LOGIC
========================== */
document.getElementById('searchInput').addEventListener('input', function(e) {
    const term = e.target.value.toLowerCase().trim();
    
    if (term === "") {
        generateFeed(); // Tampilkan semua jika kosong
        return;
    }

    const filteredIds = Object.keys(PROMPT_DATABASE).filter(id => {
        const item = PROMPT_DATABASE[id];
        const content = (item.title + " " + item.text).toLowerCase();
        return content.includes(term);
    });

    generateFeed(filteredIds);
});

/* ==========================
   SHARE PROMPT
========================== */
function sharePrompt(id) {
    if (typeof PROMPT_DATABASE === 'undefined' || !PROMPT_DATABASE[id]) return;
    const url = window.location.origin + window.location.pathname.replace("index.html", "") + "prompt.html?id=" + id;
    if (navigator.share) {
        navigator.share({ title: PROMPT_DATABASE[id].title, url }).catch(console.error);
    } else {
        window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`);
    }
}
</script>

<div class="floating-stack">
  <div class="floating-visitor" id="visitorBar">
    üëÅÔ∏è <span id="visitorToday">0</span> ¬∑ <strong id="visitorTotal">0</strong>
  </div>
  <a href="https://youtube.com/@kokosimaabsurd" class="floating-youtube" target="_blank">‚ñ∂</a>
</div>

<script src="visitor.js" defer></script>
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js').catch(err => console.log('SW error:', err));
    });
  }
</script>
</body>
</html>
