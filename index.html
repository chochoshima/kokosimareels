<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kokosima AI - Katalog Prompt Cinematic</title>
<meta name="description" content="Koleksi prompt AI Cinematic gratis untuk Midjourney, Dall-E, dan Stable Diffusion.">
<link rel="stylesheet" href="style.css">
</head>
<body>

<!-- HEADER -->
<header class="top-bar">
    <a href="index.html" class="logo-link"><span class="logo">üß† kokosima</span></a>
    <a href="https://www.facebook.com/chochoshima/" target="_blank" aria-label="Facebook">Facebook</a>
    <a href="https://www.youtube.com/@kokosimaabsurd/" target="_blank" aria-label="YouTube">YouTube</a>
</header>

<!-- FEED -->
<main class="feed" id="main-feed"></main>

<!-- DATA -->
<script src="data.js"></script>

<script>
/* ==========================
   VIEWPORT MOBILE HEIGHT
========================== */
function setVh(){
    const vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
}
window.addEventListener('resize', setVh);
window.addEventListener('load', setVh);
setVh();

/* ==========================
   FEED GENERATOR (ANTI-CRASH)
========================== */
const CHANNEL_YOUTUBE = "https://youtube.com/@kokosimaabsurd";
const feedContainer = document.getElementById("main-feed");

function generateFeed() {
    // 1. CEK APAKAH DATABASE BERHASIL DIMUAT
    // Jika data.js error syntax (kurung kurang, dll), PROMPT_DATABASE tidak akan ada.
    if (typeof PROMPT_DATABASE === 'undefined') {
        console.error("CRITICAL: PROMPT_DATABASE tidak ditemukan. Cek syntax error di data.js");
        feedContainer.innerHTML = `
            <div style="text-align:center; padding: 2rem; color: #cc0000;">
                <h3>Gagal Memuat Data</h3>
                <p>Terjadi kesalahan pada file data (Syntax Error). Cek Console Browser.</p>
            </div>`;
        return;
    }

    const fragment = document.createDocumentFragment();
    const keys = Object.keys(PROMPT_DATABASE).reverse();

    if (keys.length === 0) {
        feedContainer.innerHTML = "<p style='text-align:center; padding:20px;'>Belum ada data prompt.</p>";
        return;
    }

    keys.forEach(id => {
        // 2. GUNAKAN TRY-CATCH AGAR SATU ERROR TIDAK MEMATIKAN SEMUA
        try {
            const data = PROMPT_DATABASE[id];

            // Validasi Data Minimal
            if (!data || !data.title) {
                console.warn(`Item ${id} di-skip karena tidak punya judul.`);
                return; 
            }

            // 3. HANDLING TEXT AMAN (Mencegah error jika data.text undefined)
            // Jika data.text kosong, pakai string kosong "" agar .split() tidak error
            const safeText = data.text || ""; 
            const words = safeText.split(/\s+/);
            const previewText = words.length > 0 
                ? words.slice(0, 12).join(" ") + (words.length > 12 ? "..." : "")
                : "Tidak ada deskripsi.";

            // Logika Tombol
            const hasVideo = data.videoUrl && data.videoUrl !== "#";
            const btnLabel = hasVideo ? "‚ñ∂ Video" : "üì∫ Channel";
            const btnHref = hasVideo ? data.videoUrl : CHANNEL_YOUTUBE;
            const btnStyle = hasVideo ? "" : "style='background:#cc0000;color:#fff;'";

            // Buat Element
            const section = document.createElement("section");
            section.className = "item";
            section.id = id;
            section.innerHTML = `
                <div class="media-container">
                    <img src="images/${id}.webp" alt="Prompt AI ${data.title}" loading="lazy" decoding="async"
                    onerror="this.onerror=null;this.src='images/${id}.jpg';">
                </div>
                <div class="content-container">
                    <h3>${data.title}</h3>
                    <p class="prompt-preview">${previewText}</p>
                    <div class="actions">
                        <a class="btn btn-primary" href="${btnHref}" target="_blank" ${btnStyle}>${btnLabel}</a>
                        <a class="btn btn-outline" href="prompt.html?id=${id}">PROMPT</a>
                        <button class="btn btn-share" onclick="sharePrompt('${id}')">üîó Share</button>
                    </div>
                </div>
            `;
            fragment.appendChild(section);

        } catch (err) {
            // Jika terjadi error parah di satu item, catat di console dan LANJUT ke item berikutnya
            console.error(`Gagal me-render item ID: ${id}`, err);
        }
    });

    feedContainer.appendChild(fragment);
}

// Jalankan fungsi
generateFeed();

/* ==========================
   SHARE PROMPT
========================== */
function sharePrompt(id) {
    // Cek lagi apakah database ada sebelum share
    if (typeof PROMPT_DATABASE === 'undefined' || !PROMPT_DATABASE[id]) return;
    
    const data = PROMPT_DATABASE[id];
    const base = location.origin + location.pathname.replace("index.html", ""); // Handle folder
    
    // Pastikan URL bersih dari double slash jika di root
    const cleanBase = base.endsWith('/') ? base : base + '/';
    const url = cleanBase + "prompt.html?id=" + id;

    if (navigator.share) {
        navigator.share({ title: data.title, url }).catch(console.error);
    } else {
        window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`);
    }
}
</script>
<!-- FLOATING STACK -->
<div class="floating-stack">
  <div class="floating-visitor" id="visitorBar">
    üëÅÔ∏è <span id="visitorToday">0</span> hari ini ¬∑
    <strong id="visitorTotal">0</strong> total
  </div>
  <a href="https://youtube.com/@kokosimaabsurd"
     class="floating-youtube"
     target="_blank"
     aria-label="YouTube Channel">‚ñ∂</a>
</div>
<script src="visitor.js" defer></script>
</body>
</html>
