<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kokosima AI - Galeri Prompt AI Paling Absurd & Realistic</title>
    
    <meta name="description" content="Koleksi prompt AI unik. Temukan berbagai inspirasi mulai dari hasil absurd hingga cinematic realistic.">
    <link rel="stylesheet" href="style.css">
    <meta name="theme-color" content="#000000">
</head>
<body>

<header class="top-bar">
    <a href="index.html" class="logo-link">üß† KOKOSIMA</a>

    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Cari prompt..." autocomplete="off">
    </div>

    <div class="social-links">
        <a href="https://www.facebook.com/chochoshima/" target="_blank">FB</a>
        <a href="https://www.youtube.com/@kokosimaabsurd/" target="_blank">YT</a>
    </div>
</header>

<main class="feed" id="main-feed"></main>

<script src="data.js"></script>
<script>
/* ==========================
   VIEWPORT & LAYOUT LOGIC
========================== */
function setVh(){
    const vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
}
window.addEventListener('resize', setVh);
window.addEventListener('load', setVh);
setVh();

/* ==========================
   FEED GENERATOR (FIXED)
========================= */
const CHANNEL_YOUTUBE = "https://youtube.com/@kokosimaabsurd";
const feedContainer = document.getElementById("main-feed");

function generateFeed(keysToRender = null) {
    if (typeof PROMPT_DATABASE === 'undefined') return;

    feedContainer.innerHTML = "";
    const fragment = document.createDocumentFragment();
    let keys = keysToRender || Object.keys(PROMPT_DATABASE);
    
    if (!keysToRender) keys = [...keys].reverse();

    if (keys.length === 0) {
        feedContainer.innerHTML = `<div class="no-results"><h3>Prompt tidak ditemukan...</h3></div>`;
        return;
    }

    keys.forEach(id => {
        const data = PROMPT_DATABASE[id];
        if (!data) return;

        const section = document.createElement("section");
        section.className = "item";
        
        // Memastikan button label dinamis
        const hasVideo = data.videoUrl && data.videoUrl !== "#";
        const btnLabel = hasVideo ? "‚ñ∂ Video" : "üì∫ Channel";
        const btnHref = hasVideo ? data.videoUrl : CHANNEL_YOUTUBE;

        section.innerHTML = `
            <div class="media-container">
                <img src="images/${id}.webp" alt="${data.title}" loading="lazy" 
                     onerror="this.src='images/${id}.jpg';">
            </div>
            <div class="content-container">
                <h3>${data.title}</h3>
                <p>${data.text ? data.text.substring(0, 60) + '...' : ''}</p>
                <div class="actions">
                    <a class="btn" href="${btnHref}" target="_blank">${btnLabel}</a>
                    <a class="btn btn-outline" href="prompt.html?id=${id}">PROMPT</a>
                    <button class="btn btn-share" onclick="sharePrompt('${id}')">üîó</button>
                </div>
            </div>
        `;
        fragment.appendChild(section);
    });
    feedContainer.appendChild(fragment);
}

// Search Logic
document.getElementById('searchInput').addEventListener('input', (e) => {
    const term = e.target.value.toLowerCase().trim();
    if (term === "") { generateFeed(); return; }
    const filtered = Object.keys(PROMPT_DATABASE).filter(id => {
        const item = PROMPT_DATABASE[id];
        return (item.title + " " + item.text).toLowerCase().includes(term);
    });
    generateFeed(filtered);
});

// Share Logic
function sharePrompt(id) {
    const url = `${window.location.origin}/prompt.html?id=${id}`;
    if (navigator.share) {
        navigator.share({ title: PROMPT_DATABASE[id].title, url });
    } else {
        navigator.clipboard.writeText(url);
        alert("Link disalin ke clipboard!");
    }
}

generateFeed();
</script>

<div class="floating-stack">
    <div class="floating-visitor" id="visitorBar">
        üëÅÔ∏è <span id="visitorToday">0</span> ¬∑ <strong id="visitorTotal">0</strong>
    </div>
    <a href="https://youtube.com/@kokosimaabsurd" class="floating-youtube" target="_blank">‚ñ∂</a>
</div>

<script src="visitor.js" defer></script>
</body>
</html>
